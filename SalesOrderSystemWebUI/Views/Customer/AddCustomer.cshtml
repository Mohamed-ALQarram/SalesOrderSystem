@model Customer

@{
    var childTypes = typeof(Customer).Assembly.GetTypes()
          .Where(t => t.IsSubclassOf(typeof(Customer)));
}
<div class="container mt-5">
    <div class="card shadow-sm p-4">
        <h3 class="text-center mb-4">Add Customer</h3>

        <form asp-action="SaveAddedCustomer" method="post">

            <div class="mb-3">
               <label  for="Type" name="Type" class="form-label" id="TypeLabel">Type</label>
                <select class="form-select" id="Type" name="Type">
                    <option value="@(Model is null ? "" : Model.GetType().Name)" disabled selected>@(Model is null ? "--Select Type--" : Model.GetType().Name)</option>

                    @foreach (var item in childTypes)
                    {

                    <option value="@item.Name">@item.Name</option>
                    }
                    </select>
            </div>
            <div id="formContainer" class="mt-3">
                @if(Model is not null)
                {
                    @if (Model is Person)
                    {
                        <partial name="PersonForm" model="Model" />
                    }
                    else if (Model is Company)
                    {
                        <partial name="CompanyForm" model="Model" />
                    }

                }
                <!-- هنا هيتحط الـPartial Form -->
            </div>
            <div class="mb-3">
                @Html.LabelFor(x => x.phone, new { @class = "form-label" })
                @Html.EditorFor(x => x.phone, new { htmlAttributes = new { @class = "form-control" } })

            </div>




            @Html.ActionLink("Back", "Index","Customer",null,
            new { @class = "btn btn-primary px-4 shadow-sm" })
            <div class="text-center">


                <button type="submit" class="btn btn-primary px-4">Save</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            $("#Type").on("change", function () {
                var type = $(this).val();
                if (type) {
                    $.get("/Customer/LoadCustomerForm", { type: type }, function (data) {
                        $("#formContainer").html(data);
                    });
                        } else {
                    $("#formContainer").empty();
                }
            });
        });
    </script>
}
